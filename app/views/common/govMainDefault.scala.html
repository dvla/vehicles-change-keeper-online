@(title: String)(content: Html)(implicit lang: Lang,
        config: utils.helpers.Config)

@import views.html.common.alternateLanguages
@import views.common.Help.HelpLinkId
@import play.api.Play
@import play.api.Play.current
@import views.common.ProtoType.FeedbackId
@import uk.gov.dvla.vehicles.presentation.common.views.html.widgets.serviceClosingWarning
@import uk.gov.dvla.vehicles.presentation.common.services.DateServiceImpl
@import uk.gov.dvla.vehicles.presentation.common.views.html.widgets.pleaseWait

<!DOCTYPE html>
    <!--[if IE 6]>         <html class="ie ie6" lang="en"> <![endif]-->
    <!--[if IE 7]>         <html class="ie ie7" lang="en"> <![endif]-->
    <!--[if IE 8]>         <html class="ie ie8" lang="en"> <![endif]-->
    <!--[if IE 9]>         <html class="ie ie9" lang="en"> <![endif]-->
    <!--[if gt IE 9]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>@title</title>

        <link rel="stylesheet" href="@controllers.StaticAssets.versioned(config.assetsUrl)("screen.min.css")" media="screen" type="text/css">

        <link rel="stylesheet" href="@controllers.StaticAssets.versioned(config.assetsUrl)("print.min.css")" media="print" type="text/css">

        <link rel="shortcut icon" href="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/images/favicon.ico")" type="image/x-icon">
        <link rel="apple-touch-icon-precomposed" href="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/images/apple-touch-icon-57x57.png")">
        <link rel="apple-touch-icon-precomposed" href="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/images/apple-touch-icon-72x72.png")" sizes="72x72">
        <link rel="apple-touch-icon-precomposed" href="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/images/apple-touch-icon-76x76.png")" sizes="76x76">
        <link rel="apple-touch-icon-precomposed" href="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/images/apple-touch-icon-114x114.png")" sizes="114x114">
        <link rel="apple-touch-icon-precomposed" href="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/images/apple-touch-icon-120x120.png")" sizes="120x120">
        <link rel="apple-touch-icon-precomposed" href="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/images/apple-touch-icon-144x144.png")" sizes="144x144">
        <link rel="apple-touch-icon-precomposed" href="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/images/apple-touch-icon-152x152.png")" sizes="152X152">

        <script>
            var _gaq = _gaq || [];
            @if(config.googleAnalyticsTrackingId.isDefined) {
                <!-- Google Analytics -->
                _gaq.push(['_setAccount', '@{config.googleAnalyticsTrackingId}']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();

                <!-- End Google Analytics -->
            }
        </script>
    </head>

    <body data-closing-time="@config.closingTimeMinOfDay" class="js-disabled">
    <script type="text/javascript">document.body.className = document.body.className.replace('js-disabled','js-enabled');</script>
    @serviceClosingWarning(config.openingTimeMinOfDay, config.closingTimeMinOfDay, config.closingWarnPeriodMins)
        <a href="#main" class="visuallyhidden">Skip to main content</a>

        <div id="global-cookie-message">
            <div class="cookie-message-wrapper">
                <p>@{Messages("global.cookiemessage")}&nbsp;<a href="http://www.gov.uk/support/cookies">@{Messages("global.cookiefindoutmore")}</a></p>
            </div>
        </div>

        <div role="banner" class="global-header" id="global-header">
            <div class="header-wrapper">
                <div class="content">
                    <div class="header-global">
                        <div class="header-logo">
                            <a href="https://www.gov.uk/" title="Go to the GOV.UK homepage" class="logo">
                              <img src="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/images/gov.uk_logotype_crown.png")" width="35" height="31">GOV.UK
                            </a>
                        </div>
                    </div>
                    <div class="header-proposition">
                        <div class="content proposition-menu">
                            <h2 class="page-title"><strong>@{Messages("change_keeper_beforeyoustart.title")}</strong></h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--end header-->

        <div role="main" id="main">
            @content
        </div>

        <div class="footer" id="footer" role="contentinfo">
            <div class="footer-wrapper vehicles-online-footer">
                <div class="footer-meta">
                    <div class="footer-meta-inner">
                        <ul>
                            <li><a href="@routes.CookiePolicy.present()" target="_blank">@Messages("footer.cookies")</a></li>
                            <li>@{Messages("footer.builtbyintro")}&nbsp;<a href="https://www.gov.uk/government/organisations/driver-and-vehicle-licensing-agency" target="_blank">@{Messages("footer.builtby")}</a></li>
                        </ul>
                        <div class="open-government-licence">
                            <h2>
                                <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/2">
                                    <img src="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/images/open-government-licence_2x.png")" alt="OGL">
                                </a>
                            </h2>
                            <p>@{Messages("footer.text1")}&nbsp;<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/2">@{Messages("footer.link")}</a>@{Messages("footer.text2")}</p>
                        </div>
                    </div>
                    @if(!Play.isTest) {
                        @* Do not fetch external assets when testing. Ideally we should have asset local and in version control *@
                        <div class="copyright print-only">
                            <img src="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/images/govuk-crest.png")" alt="Crown Copyright">
                        </div>
                        <div class="copyright">
                            <a href="http://www.nationalarchives.gov.uk/information-management/our-services/crown-copyright.htm" target="_blank">&copy;
                                Crown Copyright</a>
                        </div>
                    }
                </div>
            </div>
        </div>
        <!--end footer-->

        @pleaseWait()

        <div id="global-app-error" class="app-error hidden"></div>
        <script type="text/javascript" src="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/jquery/jquery.min.js")"></script>
        <script type="text/javascript" src="@controllers.StaticAssets.versioned(config.assetsUrl)("lib/vehicles-presentation-common/javascripts/common.js")"></script>
        <script type="text/javascript">
            var enableSendingGaEventsOnSubmit = function() {
                $('button[type="submit"]').on('click', function(e) {

                    // K2K-001: tracking the optional email fields on the details of vehicle being sold page
                    trackingOptionalRadioField("#vehicleSellerEmailOption", "seller_email");
                    // K2K-002: tracking the optional email on the private keeper details page
                    trackingOptionalRadioField("#privatekeeper_option_email", "private_keeper_email");
                    // K2K-003: tracking the optional email on the business keeper details page
                    trackingOptionalRadioField("#businesskeeper_option_email", "business_keeper_email");
                    // K2K-004: tracking the optional fleet number on the business keeper details page
                    trackingOptionalRadioField("#fleetNumberOption", "fleet_number");

                    //K2K-006: tracking driving licence number on the private keeper details page
                    trackingOptionalFields("#privatekeeper_drivernumber", "driving_licence");
                    //K2K-007: tracking the vehicle mileage on the sales details page
                    trackingOptionalFields("#mileage", "mileage");

                    //K2K-005: tracking date of birth on the private keeper details page
                    trackingDateFields("#privatekeeper_dateofbirth", "date_of_birth");

                    //K2K-010: tracking if the new owner is a business or an individual
                    trackPrivateBusiness();

                });
            };

            var addGaEventToV5Chint = function() {
                //Tracking event for click on V5C image tooltip
                if ($('.hint-image-wrap p').length) {
                    var v5cHint = $('.hint-image-wrap p');
                    v5cHint.on('click', function() {
                        var currentEvent = $('.hint-image-wrap p').attr('data-tracking');
                        _gaq.push(['_trackEvent', 'ct_link',  currentEvent, 'click',  1]);
                    });
                }
            };

            var trackPrivateBusiness = function() {
                if ($("#vehicleSoldTo_Private").is(':checked')) {
                    _gaq.push(['_trackEvent', "track_path", "individual"]);
                }
                if ($("#vehicleSoldTo_Business").is(':checked')) {
                    _gaq.push(['_trackEvent', "track_path", "business"]);
                }

            };

            // tracks an event based on the state of an optional radio box. This will work for the yes/no radio boxes.
            // you need to pass the fieldSelector (for id: #id, for class: .className) and the name of the action.
            // value is optional
            var trackingOptionalRadioField = function(fieldSelector, actionName, value) {
                var visibleField = $(fieldSelector + "_visible");
                var invisibleField = $(fieldSelector + "_invisible");

                if (value === undefined) value = 1;

                if (visibleField.is(':checked')) {
                    _gaq.push(['_trackEvent', "optional_field", actionName, 'provided', value]);
                }
                if (invisibleField.is(':checked')) {
                    _gaq.push(['_trackEvent',  "optional_field", actionName, 'absent', value]);
                }
            };

            // tracks an event based on a field that has a value. e.g. a textfield.
            var trackingOptionalFields = function(fieldSelector, actionName, value) {
                if (value === undefined) value = 1;

                if($(fieldSelector).value == "") {
                    _gaq.push(['_trackEvent', "optional_field", actionName, 'absent', value]);
                } else {
                    _gaq.push(['_trackEvent', "optional_field", actionName, 'provided', value]);
                }
            };

            var trackingDateFields = function(fieldSelector, actionName, value) {
                if (value === undefined) value = 1;

                var field_day = $(fieldSelector + "_day");
                var field_month = $(fieldSelector + "_month");
                var field_year = $(fieldSelector + "_year");

                if(field_day.value == "" || field_month.value == "" || field_year.value == "") {
                    _gaq.push(['_trackEvent', "optional_field", actionName, 'absent', value]);
                } else {
                    _gaq.push(['_trackEvent', "optional_field", actionName, 'provided', value]);
                }
            };


            // Run the common code that is not common to all but this one needs
            hideEmailOnOther('#privatekeeper_title_titleOption_4', '.form-item #privatekeeper_title_titleText');

            enableSendingGaEventsOnSubmit();
            addGaEventToV5Chint();
        </script>
        <script type="text/javascript">
            if (typeof $ !== "function" || $('html').hasClass('js-ready') === false) {
                // Either Jquery or common are not available so revert to the no-js view
                document.body.className = document.body.className.replace('js-enabled','js-disabled');
            }
        </script>
   </body>
</html>
